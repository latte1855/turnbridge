# ✅ E0501 — 營業人電子發票配號檔

**來源：MIG4.1.pdf**
（訊息功能＋結構圖＋樹狀圖＋元素規格）

* 訊息功能：
* 訊息樹狀圖：
* 資料元詳細規格：

---

# 📌 1. 訊息用途（MIG 原文）

> 「營業人電子發票配號檔」主要係提供營業人與被授權之加值中心
> 下載營業人電子發票配號紀錄檔。

Turnbridge 系統在匯入 E0501 時，必須驗證：

* 統編（BAN）
* 發票類別 InvoiceType（07 或 08）
* 年月期別（YearMonth）
* 字軌（InvoiceTrack）
* 起號/迄號範圍（Begin/End）
* 是否重疊
* 起迄號的末碼規則（00/50、49/99）

---

# 📌 2. 樹狀結構（MIG 樹狀圖）

來源：

```
InvoiceAssignNo
 ├── Ban
 ├── InvoiceType
 ├── YearMonth
 ├── InvoiceTrack
 ├── InvoiceBeginNo
 ├── InvoiceEndNo
 └── InvoiceBooklet
```

此訊息沒有 Main/Details 分區，屬於非常單純的一筆資料。

---

# 📌 3. 欄位與格式（依 MIG 逐項）

以下欄位全取自 E0501 的 Element/Aggregate 說明
（）

---

# **（1）Ban — 統一編號（M）**

* 型別：BAN
* 長度：8
* 必要性：M
* 備註：營業人統編
  來源：

---

# **（2）InvoiceType — 發票類別（M）**

* 型別：InvoiceTypeEnum
* 必要性：M
* 值域：07、08
  來源：
  （InvoiceTypeEnum 定義在 MIG 其他段落）

---

# **（3）YearMonth — 發票期別（M）**

* 型別：string(6)
* 格式：YYYYMM
  例：202401
  來源：

---

# **（4）InvoiceTrack — 字軌（M）**

* 型別：string(2)
* 限制：兩碼英文大寫
  來源：

---

# **（5）InvoiceBeginNo — 起號（M）**

* 型別：string(8)
* 格式：8 碼數字
  來源：

---

# **（6）InvoiceEndNo — 迄號（M）**

* 型別：string(8)
* 格式：8 碼數字
  來源：

---

# **（7）InvoiceBooklet — 組數（M）**

* 型別：integer
* 長度：10
* 說明：依 MIG，此值為「幾本（booklet）」
  Turnbridge 舊系統邏輯為：

  ```
  booklet = (EndNo - BeginNo) / 50 + 1
  ```

來源：

---

# 📌 4. E0501 XML 樣板（來自官方教材）

（此 XML 來源：教育訓練教材高級，與 MIG4.1 一致）

```
<InvoiceAssignNo>
    <Ban>12345678</Ban>
    <InvoiceType>07</InvoiceType>
    <YearMonth>202401</YearMonth>
    <InvoiceTrack>AB</InvoiceTrack>
    <InvoiceBeginNo>00001000</InvoiceBeginNo>
    <InvoiceEndNo>00001999</InvoiceEndNo>
    <InvoiceBooklet>20</InvoiceBooklet>
</InvoiceAssignNo>
```

---

# 📌 5. Turnbridge 系統需特別強化的驗證（補充）

此部分取自你上傳的舊系統文件

* BeginNo 末碼必須是 **00 或 50**
* EndNo 末碼必須是 **49 或 99**
* BeginNo ≤ EndNo
* 不可跨字軌、不可跨期別
* 該 BAN+期別+字軌 不得重疊其他 E0501 區間

這些你未來若需要，我可以幫你產生：

✔ Normalize 規格
✔ E0501 驗證器程式碼
✔ JPA + Liquibase Schema
✔ 自動測試（JUnit）

---

# ✅ **E0402 — 空白未使用字軌號碼檔（BranchTrackBlank）**

---

# 📌 1. 訊息用途

來源：

> 此訊息由 **總機構** 或 **加值中心（代理）** 上傳，內容為「分支機構配發，但尚未使用的字軌區間」列表。
> 平台會檢查**不可重疊（含相同）範圍**，若重疊會整包剔退。

---

# 📌 2. 樹狀結構（依 MIG）

來源：

```
BranchTrackBlank
 ├── Main
 │     ├── HeadBan
 │     ├── BranchBan
 │     ├── InvoiceType
 │     ├── YearMonth
 │     └── InvoiceTrack
 │
 └── Details
        └── BranchTrackBlankItem (1..25000)
              ├── InvoiceBeginNo
              └── InvoiceEndNo
```

E0402 與 E0401 類似，但重點不同：

* **E0401 = 已分配（包含使用與未使用）之區間 + 可含 Booklet**
* **E0402 = 只包含「未使用（空白）」區間」且無 Booklet**

---

# 📌 3. Main 區塊欄位表

來源：

* Main 結構：
* 型別規格與必要性：

| 欄位               | 必要性 | 型別              | 備註       |
| ---------------- | --- | --------------- | -------- |
| **HeadBan**      | M   | BAN             | 總公司統編    |
| **BranchBan**    | M   | BAN             | 分支機構統編   |
| **InvoiceType**  | M   | InvoiceTypeEnum | 07 或 08  |
| **YearMonth**    | M   | YearMonth (6 碼) | 例：202401 |
| **InvoiceTrack** | M   | 字軌（string 2）    | 例：AB     |

補充：
InvoiceTypeEnum pattern 限制：
來源：

> `[07,08]`

---

# 📌 4. Details → BranchTrackBlankItem 區塊欄位表

來源：

* 字軌區間規格：
* MIG 樹狀圖：

| 欄位                 | 必要性 | 型別        | 備註     |
| ------------------ | --- | --------- | ------ |
| **InvoiceBeginNo** | M   | string(8) | 未使用起始號 |
| **InvoiceEndNo**   | M   | string(8) | 未使用結束號 |

---

# 📌 5. 重要規則（官方規範）

來源：

> 上傳同一包不可重疊（含重覆）區間，否則平台會整包剔退並回覆
> 「上傳明細區間重疊（含重覆），請於檢查後再行上傳」。

Turnbridge 系統需在 Normalize 階段檢查是否：

* begin ≤ end
* 區間不與其他 Item 重疊
* 不可與 E0401 的已使用區間衝突（前端管理用）

---

# 📌 6. XML 範例（來自官方教材）

來源：

```
<BranchTrackBlank>
    <Main>
        <HeadBan>12345678</HeadBan>
        <BranchBan>87654321</BranchBan>
        <InvoiceType>07</InvoiceType>
        <YearMonth>10606</YearMonth>
        <InvoiceTrack>AB</InvoiceTrack>
    </Main>
    <Details>
        <BranchTrackBlankItem>
            <InvoiceBeginNo>00001080</InvoiceBeginNo>
            <InvoiceEndNo>00001499</InvoiceEndNo>
        </BranchTrackBlankItem>
    </Details>
</BranchTrackBlank>
```

---

# 📌 7. 小結：E0402 與 E0401 差異

| 項目    | **E0401**                 | **E0402**   |
| ----- | ------------------------- | ----------- |
| 用途    | 配號（含使用與未使用）               | 空白未使用號段     |
| 明細欄位  | Begin / End / **Booklet** | Begin / End |
| 檔案用途  | 取號記錄                      | 未使用號段上傳     |
| 被覆蓋規則 | 後傳覆蓋前傳                    | 若重疊則整包剔退    |

必要時我也能幫你做比較圖、資料庫 Schema 設計、匯入流程。

---
